global:
  scrape_interval: 15s
  evaluation_interval: 15s

# Koppel de regels
rule_files:
  - "alert.rules.yml"

# Koppel Alertmanager
alerting:
  alertmanagers:
    - static_configs:
        - targets:
           - alertmanager:9093

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # node-exporter draait op het host netwerk, dus we gebruiken 'host.containers.internal' om er toegang toe te krijgen vanuit de container.
  - job_name: 'fedora-workstation'
    static_configs:
      - targets: ['host.containers.internal:9100']

  - job_name: 'podman-exporter'
    static_configs:
      - targets: ['host.containers.internal:9882']

  - job_name: 'alertmanager'
    static_configs:
      - targets: ['alertmanager:9093']

  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']

  - job_name: 'loki'
    static_configs:
      - targets: ['loki:3100']

  - job_name: 'alloy'
    static_configs:
      - targets: ['alloy:12345']

  - job_name: 'karma'
    static_configs:
      - targets: ['karma:8080']

  # http probes voor de verschillende services. We gebruiken de blackbox exporter om deze probes uit te voeren.
  - job_name: 'blackbox-http'
    metrics_path: /probe
    params:
      module: [http_2xx]
    static_configs:
      - targets:
        # Karma
        - http://karma:8080/health
        # Prometheus (Zichzelf checken)
        - http://prometheus:9090/-/healthy
        # Grafana
        - http://grafana:3000/healthz
        # Alertmanager
        - http://alertmanager:9093/-/healthy
        # Alloy
        - http://alloy:12345/-/healthy
        # Loki
        - http://loki:3100/ready
        # Podman Exporter
        - http://podman-exporter:9882
        # Node Exporter (Let op: draait op host netwerk!)
        - http://host.containers.internal:9100
        # Prometheus Blackbox Exporter
        - http://blackbox-exporter:9115/-/healthy
        # tempo
        - http://tempo:3200/ready
        # OTel Collector
        - http://otel-collector:8888/metrics
        # MinIO
        - http://minio:9000/minio/health/ready
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: blackbox-exporter:9115

  - job_name: 'blackbox_exporter'
    static_configs:
      - targets: ['blackbox-exporter:9115']

  - job_name: 'tempo'
    static_configs:
      - targets: ['tempo:3200']

  - job_name: 'otel-collector'
    static_configs:
      - targets: ['otel-collector:8888']

  # MinIO heeft verschillende metrics endpoints, dus we definiÃ«ren meerdere jobs voor elk type metric.
  - job_name: 'minio'
    metrics_path: /minio/v2/metrics/cluster
    scheme: http
    static_configs:
      - targets: ['minio:9000']
  - job_name: minio-job-bucket
    metrics_path: /minio/v2/metrics/bucket
    static_configs:
    - targets: ['minio:9000']
  - job_name: minio-job-node
    metrics_path: /minio/v2/metrics/node
    static_configs:
    - targets: ['minio:9000']
  - job_name: minio-job-resource
    metrics_path: /minio/v2/metrics/resource
    static_configs:
    - targets: ['minio:9000']